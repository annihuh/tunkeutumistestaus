# Fuff faster

Kolmas läksy Tunkeutumistestaus-kurssille.

Kurssi ja tehtävänanto löytyy [täältä](https://terokarvinen.com/2024/eettinen-hakkerointi-2024/#h3-fuff-faster).

Kone on irroitettu netistä varsinaisten testien ajaksi.

## x) Lue ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva kustakin artikkelista. Kannattaa lisätä myös jokin oma ajatus, idea, huomio tai kysymys.)

### Find Hidden Web Directories - Fuzz URLs with ffuf

Lähde: https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

Ohje piilotettujen hakemistojen löytämiseen automaattisesti ffuf:n avulla.

Ffuf on fuzzaamiseen kehitetty työkalu, jonka on luonut joohoi, Joona Hoikkala.

- Lataa kohdesivu
- Kokeile sivun löytämistä manuaalisesti
- Asenna ffuf
- Lataa "sanakirja" yleisimmistä poluista
- Fuzzaa
- Filteröi tulokset
- Kokeile löytyykö sivu tuloksilla 

### Cracking Passwords with Hashcat

Lähde: https://terokarvinen.com/2022/cracking-passwords-with-hashcat/

Salasanat säilyteytään järjestelmissä hash-tiivisteinä.

Ohje salasanojen murtamiseen Hashcatin avulla.

- Asenna Hashcat
- Luo uusi hakemisto tuloksille
- Lataa salasana sanakirja/sanasto yleisimmistä salasanoista
- Identifioi hash-tyyppi
- Ratkaise salasana

### Crack File Password With John

Lähde: https://terokarvinen.com/2023/crack-file-password-with-john/

Ohje salasanojen murtamiseen John the Ripperin avulla.

- Asenna tarvittavat työkalut
- Asenna John the Ripper
- Lataa zip-tiedosto
- Murra salasana 

## a) Asenna Hashcat ja testaa sen toiminta murtamalla esimerkkisalasana.

Tein tehtävän aikaisemmin asentamallani Kali Linuxilla.

Apuna käytin [tätä](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/) ohjetta.

Päivitin ensimmäiseksi koneen "pakettivaraston".

    sudo apt-get update


Sen jälkeen olin asentamassa kolmea eri ohjelmaa: hashID, Hashcat ja wget, mutta ne olikin jo kaikki valmiiksi asennettuna. HashID on työkalu, joka tunnistaa erilaisia hash-arvoja, Hashcat on työkalu, jolla murretaan salasanoja ja wget:n avulla voidaan hakea ja ladata tiedostoja.

    sudo apt-get install hashid hashcat wget

Loin uuden hakemiston, johon talletan kaikki tulokset. 

    mkdir hashkissa

Siirryin hakemistoon.

    cd hashkissa

Latasin Githubista wget-työkalun avulla halutun rockyou.txt -tiedoston.

    wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz

Purin tiedoston tar-työkalulla. Komennon `x`, extract tarkoittaa purkamista ja `f`, file tarkoittaa tiedostoa. Käytännössä siis `xf` määrittelee, että haluan purkaa tiedoston.

    tar xf rockyou.txt.tar.gz

Lopuksi poistin tarpeettoman tar.gz -tiedoston.

    rm rockyou.txt.tar.gz

Head-komennolla katsoin tekstitiedoston ensimmäisiä rivejä.

    head rockyou.txt

Tiedostossa on mahdollisia salasanoja listattuna:

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/ea4464a8-90b0-42d7-9d81-5bb8c65394a2">

Tiedoston rivimäärän tarkastin näin:

    wc -l rockyou.txt 

Komento `wc` tulostaa tiedoston rivimäärän (lines) `-l`, halutusta tiedostosta. 

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/5de3f9e3-dd8b-4b65-8158-b1a8309d4d19">

Rivejä oli yhteensä 14344391.

Salasanan murtamiseksi tarvitsen salasanan ja hash-arvon. Tein arvon täällä: https://md5.gromweb.com/ MD5 hashin.

Hash: 482c811da5d5b4bc6d497ffa98491e38

Tiedän valmiiksi, minkä tyyppinen hash on, mutta kokeilin vielä ajaa ohjeessa annetun komennon. `-m` eli mode tarkoittaa, että sisällytä vastaava hashcat mode tulosteessa. Vastauksena on lista erilaisista hash-tyypeistä.

         hashid -m 482c811da5d5b4bc6d497ffa98491e38

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/89502943-5beb-4762-9a2e-7ba3bb2c6676">

Ajoin hashcat-komennon, joka käyttää MD5 hash-tyyppiä `-m 0` ratkaistakseen annetun tiivisteen. Komento käy läpi rockyou.txt-tiedostoa, missä yleisimmät salasanat ovat. Lopuksi tulos tallennetaan `-o` tiedostoon nimeltä salasana.

         hashcat -m 0 '482c811da5d5b4bc6d497ffa98491e38' rockyou.txt -o salasana

Tulos ei ollut sellainen kuin olisin halunnut. Koneen muisti on liian pieni komennon suorittamiseen.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/a761c391-ed93-4151-b666-868f08ac407c">

Sammutin koneen ja lisäsin muistia network-asetuksista (2048MB > 3072MB).

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/77e46858-e880-419f-b217-e91b3e37fdb6">

Käynnistin koneen ja testasin uudestaan. Nyt komento toimi.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/a3b6709c-6bdb-4fcc-92c3-037bf9bd7dee">

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/c93e8005-2fad-4202-bf26-a9185c7c824b">

Mitä ymmärsin vastauksesta:

- hashcat käynnistyy
- tietoa OpenCL API:sta
- tietoa laitteesta
- kernelin tukemat salasanapituudet
- käytetään yhtä sääntöä
- varoitus optimoimattomista backend kerneleistä
- watchdog pitää huolta, että koneen lämpötila ei nouse yli 90 asteen
- vaadittu muisti, että hyökkäys voidaan suorittaa
- tietoja sanakirja-tiedostosta (dictionary)
- infoa suoritetusta komennosta
- aloitus- ja lopetusaika

Tarkistin tuloksen.

    cat salasana

Tiedostossa on hash-arvon salasana ymmärrettävässä muodossa. Salasana oli password123.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/09686e88-6158-4305-b500-3c45e7ce5b5c">

## b) Salainen, mutta ei multa. Ratkaise dirfuzt-1 artikkelista Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf

Käytin Tero Karvisen ohjetta tehtävän tekemisessä: https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/.

Haasteessa tarkoituksena on löytää admin-sivu ja versionhallintaan liittyvä sivu.

Latasin ensimmäiseksi kohteen, jota fuzzaan.

    wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-1

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/beabc09f-5f3e-48e8-ba5b-4d41e1efe099">

Muutin tiedoston oikeudet. `chmod` eli change file mode bits vaihtaa tiedoston oikeudet. Kirjaimet `u` eli owner ja `x` eli execute antaa execute-oikeudet tiedoston omistajalle.

        chmod u+x dirfuzt-1

Ajoin tiedoston.

    ./dirfuzt-1

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/81d84224-27a1-47cb-9de8-daafe090cbae">

Ja menin annettuun osoitteeseen.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/cb832a58-0c6a-4a90-abe8-b89cf372ab59">

Toisessa terminaalissa latasin wgetillä ffuf-ohjelman.

    wget https://github.com/ffuf/ffuf/releases/download/v2.1.0/ffuf_2.1.0_linux_amd64.tar.gz

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/3fbe19fd-167d-4b59-a629-cafdbb7deca8">

Purin tiedoston.

    tar xf ffuf_2.1.0_linux_amd64.tar.gz

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/75538c51-5947-4f5f-a52d-5265804b329f">

Ja poistin turhan tiedoston.

    rm ffuf_2.1.0_linux_amd64.tar.gz

Sen jälkeen latasin tiedoston yleisimmistä (web) poluista.

    wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt

Tiedosto common.txt latautui onnistuneesti.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/ca9871a5-87e9-4449-84fa-4f3b9a1ef5cb">

Pätkän tiedoston sisällöstä sai näin:
    
    head common.txt

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/00ea3ee6-5d5f-4534-b7aa-354c7641127d">

Rivimäärä on 4726, sen sai selville komennolla:

    wc -l common.txt

Ffuf:n parametrejä näkee esimerkiksi näin:

    ./ffuf | less

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/f1677856-372d-46cc-b5ff-2f5656219681">

Fuzzasin nettisivua. Ffuf kokeilee koko sanalistaa (wordlist) common.txt kohtaan FUZZ. Parametrillä `-u` määritellään kohde URL.

    ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/c88d46e6-52fe-4434-8fde-14d521bfc19a">

Tuloksia tuli melkein 5000. Jotta saan tuloksista oikean vastauksen selville, filteröin tuloksia. Käytin filtteriä `-fs`, joka filteröi tuloksia koon perusteella. Filteröinti poistaa tuloksia. Eniten tuloksia tuli 154, joten suodatan ne pois tuloksista.

    ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 132

Vastaukseksi sain seitsemän tulosta.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/a9fa58a0-ce55-4989-bd33-c5f2c02aac3e">

Admin sivu oli tuloksista viimeinen wp-admin.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/1b672c5a-d816-480f-9776-c91becd9606e">

Versiokontrolli-sivu oli esimerkiksi .git. 

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/31944be9-f07c-4b36-9a62-ce84fec570bc">

## c) Asenna John the Ripper ja testaa sen toiminta murtamalla jonkin esimerkkitiedoston salasana.

Tehtävän tekemiseen käytin Tero Karvisen ohjetta työkalusta: https://terokarvinen.com/2023/crack-file-password-with-john/.

Asensin työkalut, mitä tehtävässä tarvitaan.

    sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib1g-gst libbz2-1.0 libbz2-dev atool zip wget

Pakettia zlib-gst eikä zlib1g-gst tunnistettu, kun ajoin komentoa. En ole varma, miten paketti vaikuttaa Jack The Ripperin käyttämiseen. Kokeilen ilman sitä.

Tarvittavien työkalujen selitykset löytyi ohjeesta.

<img width="auto" alt="image" src="https://github.com/annihuh/tunkeutumistestaus/assets/101214286/f53595fd-9460-409f-a7bb-e2588d33d25a">








## d) Fuffme. Asenna Ffufme harjoitusmaali paikallisesti omalle koneellesi. Ratkaise tehtävät (kaikki paitsi ei "Content Discovery - Pipes")



## e) Tee msfvenom-työkalulla haittaohjelma, joka soittaa kotiin (reverse shell). Ota yhteys vastaan metasploitin multi/handler -työkalulla.



## f) Asenna Windows virtuaalikoneeseen. Voi olla esimerkiksi Metasploitable 3 tai Microsoftin sivuilta saatava ilmainen kokeiluversio.



## g) Ota Windowsiin graafinen etähallintayhteys Linuxista. Käytä RDP:tä eli Remote Desktop Protocol.



## Lähteet

https://terokarvinen.com/2024/eettinen-hakkerointi-2024/

https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

https://terokarvinen.com/2022/cracking-passwords-with-hashcat/

https://terokarvinen.com/2023/crack-file-password-with-john/

https://chat.openai.com/

Komentojen head ja wc man-sivut.

https://forum.hackthebox.com/t/hashcat-issue/265438
